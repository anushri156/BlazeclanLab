<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        td,th {
            border: double;
        }
    </style>
    <script src="./logic.js"></script>
    <script>
        window.onload=function(){
            var logic = new appLogic();

            var options = '';
            for(var i=0;i<logic.categories.length;i++){
                options+= '<option value="' + logic.categories[i] +'">'+ logic.categories[i] +'</option>'
            }

            document.getElementById('categoryname').innerHTML = options;


            var products = logic.getProducts();
             

            generateTable(products);

            function generateTable(products){

                var headers;
                // read the 0th record fro the array
                var prd = products[0];
                var columns = [];
                
                // read all keys of 0th index
                //for(var c in prd){
                //    columns.push(c);
               // }

               columns = Object.keys(prd);
               var row = '<tr>';
               for(var c in columns){
                headers+= '<th>'+ columns[c]+'</th>';
               }
               row+= headers + '</tr>';

               document.getElementById('thead').innerHTML = row;
                var tr = ''
                for(var r=0; r<products.length;r++){
                    tr+='<tr onclick="myfunction(this)" class="tablerow"><td class="class_productId">' + products[r].ProductId + '</td><td class="prodname">' +products[r].ProductName+'</td><td class="categoryid">'+ products[r].CategoryName+'</td><td class="priceid">' +products[r].Price+' </td><tr>';
                }
                document.getElementById('tbody').innerHTML = tr;
            }

            document.getElementById('clear').addEventListener('click', function(){
                var inputs = document.getElementsByClassName('c1');
                for(var i in inputs) {
                    inputs[i].value = '';
                }
            },false);

            document.getElementById('save').addEventListener('click', function(){
                // define an object literal
                var id= parseInt(document.getElementById('productid').value);
                var myElements = document.getElementsByClassName("class_productId");
for(var i = 0; i < myElements.length; i++)
{
    //debugger;
    var temp=myElements[i].innerHTML;
    if(temp==id) {
                    
                         alert('ProductId cannot be repeated');
                         
    
                         
}  } 
                var prd = {};
                prd.ProductId = document.getElementById('productid').value; 
                prd.ProductName = document.getElementById('productname').value; 
                prd.CategoryName = document.getElementById('categoryname').value; 
                prd.Price = document.getElementById('price').value; 

                products = logic.addProduct(prd);
                generateTable(products);
            },false);

            document.getElementById('productid').addEventListener('change',function(){
                var id = parseInt(this.value);
                if(id < 0) {
                    this.style.backgroundColor = 'red';
                    document.getElementById('dvValidations').innerHTML += 'ProductId cannot be -ve';
                } else {
                    this.style.backgroundColor = null;
                }
            },false)
            document.getElementById('productid').addEventListener('change',function(){
                var id = parseInt(this.value);
                
               // debugger;

var myElements = document.getElementsByClassName("class_productId");
for(var i = 0; i < myElements.length; i++)
{
    //debugger;
    var temp=myElements[i].innerHTML;
    if(temp==id) {
                    
                         alert('ProductId cannot be repeated');
    
                         
}  } 
},false)   





                
            document.getElementById('price').addEventListener('change',function(){
               // debugger;
                var id = parseInt(document.getElementById('price').value);
                var categoryname1=document.getElementById("categoryname").value;
                if(categoryname1=="ECT" && id<1000)
                {
                alert("for ECT minimum price should be 1000");
                }
                if(categoryname1=="ECL" && id<20)
                {
                alert("for ECL minimum price should be 20");
                }
                if(categoryname1=="FOD" && id<10)
                {
                alert("for ECT minimum price should be 10");
                }
                if(id < 0) {
                    this.style.backgroundColor = 'red';
                    document.getElementById('dvValidations2').innerHTML += 'Price cannot be -ve';
                } else {
                    this.style.backgroundColor = null;
                }
                
            },false)
        }
          
function myfunction(instance)
{document.getElementById("update").style.visibility = "visible";
        document.getElementById("save").style.visibility = "hidden";
    index = instance.rowIndex;
        // console.log('edit', index);

        getEmpid = document.getElementById("table").rows[index].cells[0].innerHTML;
        getName = document.getElementById("table").rows[index].cells[1].innerHTML;
        getDep = document.getElementById("table").rows[index].cells[2].innerHTML;
        getprice = document.getElementById("table").rows[index].cells[3].innerHTML;
        

        document.getElementById("productid").value = getEmpid;
        document.getElementById("productname").value = getName;
        document.getElementById("categoryname").value = getDep;
        document.getElementById("price").value = getprice;

};
var index;
function updateData()
     {
        document.getElementById("save").style.visibility = "visible";
        document.getElementById("update").style.visibility = "hidden";

        //console.log('update', index);

        document.getElementById("table").rows[index].cells[0].innerHTML = document.getElementById("productid").value;
        document.getElementById("table").rows[index].cells[1].innerHTML = document.getElementById("productname").value;
        document.getElementById("table").rows[index].cells[2].innerHTML = document.getElementById("categoryname").value;
        document.getElementById("table").rows[index].cells[3].innerHTML = document.getElementById("price").value;
        index = 0;
        //document.getElementById("myForm").reset();
    }
        
    </script>
</head>
<body>
    <h1>The JavaScript Application</h1>
    <div id="dvValidations"></div>
    <div id="dvValidations1"></div>
    <div id="dvValidations2"></div>
    <table style="border: double;">
        <tbody>
            <tr>
                <td>Product Id</td>
                <td>
                    <input type="text" id="productid" class="c1">
                </td>
            </tr>
            <tr>
                <td>Product Name</td>
                <td>
                    <input type="text" id="productname" class="c2">
                </td>
            </tr>
            <tr>
                <td>Category Name</td>
                <td>
                    <select type="text" id="categoryname"></select>
                </td>
            </tr>
            <tr>
                <td>Price</td>
                <td>
                    <input type="text" id="price" class="c3">
                </td>
            </tr>
            <tr>
                <td>
                    <input type="button" value="Clear" id="clear">
                </td>
                <td>
                    <input type="button" value="Save" id="save">
                    <input type="button" value="update" onclick="updateData()" id="update" style="visibility:hidden">
                </td>
                
                   
            
            </tr>
        </tbody>
    </table>
    <hr>
    <table id="table" style="border: double;">
        <thead id="thead">
            
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</body>
</html>